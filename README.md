
Python Web Application with Nginx Load Balancer and MySQL Database
=================================================================

This project sets up a Python web application running in Docker containers, managed with Docker Compose. 
It includes an official Nginx load balancer, multiple application replicas, and a MySQL database with persistent storage and logs, fulfilling the specified tasks.

Table of Contents
-----------------
1. Project Overview
2. Features
3. Architecture
4. Prerequisites
5. Installation
6. Usage
7. Accessing the Application
8. Scaling the Application
9. Project Structure
10. Logging and Persistence
11. Sticky Sessions
12. Contributing
13. License
14. Contact

Project Overview
----------------
This project demonstrates a containerized Python web application deployed using Docker Compose, fulfilling the following tasks:

### Create a Private GitHub Repository:
- All source code is pushed to a private GitHub repository.

### Set Up Docker Environment:
1. **Nginx Load Balancer:**
   - Uses the official Nginx image (not Plus or any other variant).
   - Configured to listen on port 80 and route traffic to the application containers.
   - Does not use ip_hash in the Nginx configuration.
2. **Application Containers:**
   - Runs on 3 replica containers.
   - Logs generated by the application are retained and accessible even after the containers are stopped.
   - The application is written in Python.
3. **Database Container:**
   - Sets up a MySQL DB container.
   - Data and logs are retained and accessible after the container is stopped.

### Write a Python Web Server Application:
- **Routes:**
  1. `/` Route:
     - Adds +1 to a global counter and saves it to the database.
     - Creates a cookie valid for 5 minutes containing the server's internal IP.
     - Records the date and time, the client’s IP address, and the server's internal IP address in a MySQL table named `access_log`.
     - Returns the server's internal IP address to the browser.
  2. `/showcount` Route:
     - Returns the current value of the global counter to the browser.
- **Deployment:**
  - Runs within the application containers using Docker.

### Create a Bash Script to Scale Application Containers:
- Develops a script to change the scale of the application containers to 5 (both scale up and scale down).

### Implement Sticky Sessions in Nginx:
- Using the cookie from the application, creates a stickiness engine in the Nginx load balancer.
- Ensures that once a client gets a response from one server, subsequent requests are directed to the same server for the next 5 minutes.

Features
--------
- **Dockerized Services:** All components run in Docker containers for easy deployment and management.
- **Official Nginx Load Balancing:** Distributes incoming traffic across multiple application instances without using `ip_hash`.
- **Sticky Sessions:** Implements session persistence using cookies to direct clients to the same server.
- **Scalability:** Easily scale application instances up or down using a provided script.
- **Persistent Storage:** Data and logs are retained even after containers stop.
- **Python Web Application:** Provides two routes for interaction and data manipulation.

Architecture
------------
- Client -> Nginx Load Balancer -> Application Instances (x) -> MySQL DB
- Persistent logging and storage for both MySQL and Nginx.

Prerequisites
-------------
- Docker and Docker Compose installed on your system.
- Git installed for cloning the repository.

Installation
------------
1. **Clone the Repository:**

```bash
git clone https://github.com/ItayOlivcovitz/Home-Assignment
cd your-private-repo
```

2. **Set Up Environment Variables (if any):**
   - Create a `.env` file if required and set necessary environment variables.

3. **Build and Start Services:**

```bash
docker-compose up --build
```

Usage
-----
### Accessing the Application
1. **Main Route (`/`):**
   - Visit `http://localhost/` in your web browser. Each refresh will:
     - Increment a global counter and save it to the database.
     - Set a cookie with the server's internal IP, valid for 5 minutes.
     - Log the date and time, client's IP address, and the server's internal IP address to the `access_log` table in MySQL.
     - Display the server's internal IP address.
2. **Show Count Route (`/showcount`):**
   - Visit `http://localhost/showcount` to view the current value of the global counter.

### Scaling the Application
1. **Scale Up or Down:**

```bash
./scale_app.sh 5
```

Project Structure
-----------------
```bash
├── app
│   ├── app.py             # Python application source code
│   ├── Dockerfile         # Dockerfile for the application
│   └── requirements.txt   # Python dependencies
├── db
│   ├── init.sql           # Initial SQL script to set up the database
│   └── my.cnf             # MySQL configuration file
├── nginx
│   └── nginx.conf         # Nginx configuration file
├── data
│   └── db                 # Persistent data volume for MySQL
├── logs
│   ├── db                 # Logs for the MySQL database
│   │   ├── error.log
│   │   ├── general.log
│   │   └── slow.log
│   └── nginx              # Logs for Nginx
│       ├── error.log
│       └── access.log
├── docker-compose.yml     # Docker Compose configuration
├── scale_app.sh           # Script to scale application replicas
└── README.md              # Project documentation
```

Logging and Persistence
-----------------------
- **Application Logs:** Stored in accessible directories on the host machine.
- **Nginx Logs:** Access and error logs stored persistently.
- **Database Data and Logs:** Retained even after containers stop.

Sticky Sessions
---------------
- Nginx uses cookies for session persistence.
- Clients interact with the same server for 5 minutes.

Contributing
------------
1. Fork the repository.
2. Create a feature branch.
3. Commit and push changes.
4. Open a pull request.

License
-------
This project is licensed under the MIT License.

Contact
-------
For any questions, please contact: itay.olivcovitz@gmail.com
